import{r as i,c as D,ab as Q,ac as J,e as X,z as R,I as u,j as o,m as F,B as L,ad as Z,W as ss}from"./index-DU-EKnGS.js";import{L as es,E as ts}from"./ErrorBlock-BUdkLzf6.js";import{i as E,f as T,k as as,l as rs,m as os,n as is,e as k,d as I,b as B,o as x,h as g,g as y,p as Y,q as j,r as M,F as ns}from"./FormProfile-CZfmUaEn.js";import"./InputField-Dx5_wTQe.js";import"./CheckboxField-DUJjFyXR.js";const ds=s=>({action:"changeEmail",email:s}),cs=s=>({action:"setFirstName",firstName:s}),ls=s=>({action:"setLastName",lastName:s}),ms=s=>({action:"addAddress",address:s}),fs=s=>({action:"removeAddress",addressKey:s}),us=s=>({action:"setDefaultShippingAddress",addressKey:s}),Es=s=>({action:"setDefaultBillingAddress",addressKey:s}),ps=s=>({action:"setDateOfBirth",dateOfBirth:s}),h="profile",As=`${h}__form`,U=`${h}__buttons`,W=`${h}__btn`,Ss=s=>{const{className:m,userData:e,...v}=s,V=D(h,m),[p,C]=i.useState(E.view),[w,A]=i.useState(!1),[$,d]=i.useState(""),[N]=Q(),[K]=J(),{t:c}=X(),G=i.useCallback(()=>{C(E.update)},[]),H=i.useCallback(()=>{C(E.view),d("")},[]),q=i.useMemo(()=>{const t={[x]:e.email||"",[Y]:!1,[M]:"",[j]:"",[B]:e.firstName||"",[I]:e.lastName||"",[k]:e.dateOfBirth||"",[g]:"",[y]:"",[T]:e.addresses.map(({streetName:a,city:n,postalCode:P,country:f,key:l})=>({key:l||"",[is]:a||"",[os]:n||"",[rs]:P||"",[as]:f||""}))},{defaultBillingAddressId:S,defaultShippingAddressId:_}=e;if(S){const a=e.addresses.find(n=>n.id===S);a&&a.key&&(t[g]=a.key)}if(_){const a=e.addresses.find(n=>n.id===_);a&&a.key&&(t[y]=a.key)}return t},[e]),z=i.useCallback(async t=>{const{addresses:S,version:_}=e;let a=_;const n=t[T].map(r=>({...r,firstName:t[B],lastName:t[I]})),P=[ds(t[x]),cs(t[B]),ls(t[I]),ps(t[k]),...S.map(({key:r})=>fs(r||"")),...n.map(r=>ms(r))];d(""),A(!0);const f=await N({version:a,actions:P});if(f.error){d(f.error.data),A(!1);return}else R.success(c(u.UserInformationWasUpdated)),a=f.data.version;const l=[],O=t[y],b=t[g];if(O&&l.push(us(O)),b&&l.push(Es(b)),l.length){const r=await N({version:a,actions:l});if(r.error){d(r.error.data),A(!1);return}else R.success(c(u.TheDefaultAddressesWereUpdated)),a=r.data.version}if(t[Y]){const r=await K({version:a,currentPassword:t[M],newPassword:t[j]});r.error?d(r.error.data):R.success(c(u.ThePasswordChanged))}A(!1)},[e,N,c,K]);return o.jsxs("section",{className:V,...v,children:[o.jsx("div",{className:D(F,As),children:o.jsx(ns,{formInitialValues:q,mode:p,isSubmitting:w,error:$,onFormSubmit:z,setError:d},p)}),o.jsx("div",{className:D(F,U),children:o.jsxs("div",{className:U,children:[o.jsx(L,{className:W,type:"button",el:"button",view:"primary",theme:"primary",disabled:p===E.update,onClick:G,children:c(u.Edit)}),o.jsx(L,{className:W,type:"button",el:"button",view:"primary",theme:"primary",disabled:p===E.view||w,onClick:H,children:c(u.Cancel)})]})})]})},_s=i.memo(Ss),hs="view-profile",Ns=()=>{const{isError:s,data:m}=Z();let e;return m?s?e=o.jsx(ts,{isBlock:!0}):m&&(e=o.jsx(_s,{userData:m})):e=o.jsx(es,{}),o.jsx("main",{className:hs,children:o.jsx("div",{className:ss,children:e})})},gs=i.memo(Ns);export{hs as VIEW_PROFILE,gs as default};
