import{r as i,u as y,E as Ze,g as pe,j as e,L as re,c as p,G as Nt,l as Et,o as X,J as ie,I as A,m as Le,K as Y,e as ue,B as z,S as gt,O as Be,Q as Rt,R as Ge,U as xt,s as et,C as tt,X as st,n as ee,i as pt,Y as Tt,Z as ft,_ as Pt,N as It,$ as St,W as Lt,H as At}from"./index-DU-EKnGS.js";import{B as vt,a as Ot,P as jt,u as Ft,b as Mt}from"./index-DYb_b7ky.js";import{I as Te}from"./InputField-Dx5_wTQe.js";import{L as Ae,E as ve}from"./ErrorBlock-BUdkLzf6.js";import{a as nt}from"./CheckboxField-DUJjFyXR.js";import"./createNormalizedData-Cfh5aRnx.js";const Q="category-item",yt=`${Q}__name`,$t=`${Q}__link`,bt=`${Q}__img-wrap`,Dt=`${Q}__img`,Vt="categories",Ut=({id:t,locale:a})=>{const s=y(c=>Ze(c,t)),n=pe(Vt,(s==null?void 0:s.key)||"")+".jpg",r=s==null?void 0:s.name[a];return e.jsx("li",{className:Q,children:e.jsxs(re,{className:$t,to:pe(Et,t),relative:"path",children:[e.jsx("div",{className:bt,children:e.jsx("img",{className:p(Dt,Nt),src:n,alt:r})}),e.jsx("p",{className:yt,children:r})]})})},kt=i.memo(Ut),Bt="category-list",Gt=({ids:t})=>{const a=y(X),s=i.useMemo(()=>t.map(n=>e.jsx(kt,{id:n,locale:a},n)),[t,a]);return e.jsx(e.Fragment,{children:!!t.length&&e.jsx("ul",{className:Bt,children:s})})},wt=i.memo(Gt),Ht=()=>{const{categoryId:t}=ie();return{currentCategory:y(s=>t?Ze(s,t):void 0),categoryId:t}},Wt="",zt="price_asc",Kt="price_desc",Xt="name_desc",Yt="name_asc",Qt=t=>[{label:t(A.Default),value:Wt},{label:t(A.PriceAscending),value:zt},{label:t(A.PriceDescending),value:Kt},{label:t(A.NameAlphabetical),value:Yt},{label:t(A.NameInReverseOrder),value:Xt}],G=({defaultState:t,params:a,urlParamName:s,onChangeFn:n,convertToStateFn:r,convertToParamFn:c})=>{const o=a.get(s),[l,u]=i.useState(r(o,t));i.useEffect(()=>{u(r(o,t))},[o,r,t]);const _=i.useCallback(h=>{u(E=>n(h,E,t))},[n,t]),m=i.useMemo(()=>{const h=c(l);if(o!==null&&h==="")return null;if(o!==h)return h},[c,o,l]);return{state:l,urlValue:o,nextUrlValue:m,handleChange:_}},Oe="min-",D="range-slider",qt=`${D}__rail`,Jt=`${D}__inner-wrap`,we=`${D}__control`,Zt=`${D}__inner-rail`,He=`${D}__thumb`,te=`${D}__thumb_focused`,es=t=>{const{state:a,onStateChange:s,minValueControlName:n,maxValueControlName:r,className:c,...o}=t,{minValue:l,maxValue:u,values:[_,m]}=a,h=p(D,c),E=i.useRef(null),R=i.useRef(null),g=i.useRef(null),f=i.useRef(null),P=(_-l)/(u-l)*100,v=(m-l)/(u-l)*100;return i.useEffect(()=>{const d=E.current,N=R.current,C=O=>O.target.name.startsWith(Oe),I=O=>{var T,F;C(O)?(T=g.current)==null||T.classList.add(te):(F=f.current)==null||F.classList.add(te)},j=O=>{var T,F;C(O)?(T=g.current)==null||T.classList.remove(te):(F=f.current)==null||F.classList.remove(te)};return d==null||d.addEventListener("focus",I),d==null||d.addEventListener("blur",j),N==null||N.addEventListener("focus",I),N==null||N.addEventListener("blur",j),()=>{d==null||d.removeEventListener("focus",I),d==null||d.removeEventListener("blur",j),N==null||N.removeEventListener("focus",I),N==null||N.removeEventListener("blur",j)}},[]),e.jsxs("div",{...o,className:h,children:[e.jsx("input",{name:n,className:we,type:"range",value:_,min:l,max:u,onChange:s,ref:E}),e.jsx("input",{name:r,className:we,type:"range",value:m,min:l,max:u,onChange:s,ref:R}),e.jsx("div",{className:qt}),e.jsxs("div",{className:Jt,children:[e.jsx("div",{className:Zt,style:{left:`${P}%`,right:`${100-v}%`}}),e.jsx("div",{className:He,style:{left:`${P}%`},ref:g}),e.jsx("div",{className:He,style:{left:`${v}%`},ref:f})]})]})},ts=i.memo(es),We=t=>t.target.value,ze=t=>t,Ke=(t,a)=>t||a,Ce=(t,a,s)=>{const n=t.target.value,r={...a};return n in s&&(r[n]=!a[n]),r},Ne=(t,a)=>{if(t){const s={...a};return t.replaceAll('"',"").split(",").forEach(n=>{n in s&&(s[n]=!0)}),s}return a},Ee=t=>Object.entries(t).reduce((a,[s,n])=>(n&&a.push(`"${s}"`),a),[]).join(","),ss=(t,a,s)=>{const{name:n}=t.target,r={...a},c=+t.target.value,o=n.startsWith(Oe);if(!isFinite(c))return a;const l=a.values[0],u=a.values[1];return r.values=o?[Math.max(Math.min(c,u),a.minValue),u]:[l,Math.min(Math.max(c,l),a.maxValue)],r},ns=t=>(a,s)=>{if(a){const[n,r]=t(a),{minValue:c,maxValue:o}=s,l=+n,u=+r;let _=isFinite(l)?l<c?c:l>o?o:l:c,m=isFinite(u)?u>o?o:u<c?c:u:o;return _>m&&(_=m),m<_&&(m=_),{...s,values:[_,m]}}return s},as=t=>a=>t(a),b="products-header",cs=`${b}__view-mods`,rs=`${b}__form`,os=`${b}__sorting`,ls=`${b}__sorting-select`,is=`${b}__label`,us=`${b}__search`,ms=`${b}__search-input`,_s=`${b}__search-btn`,fe="view-mode",Pe="search-text",le="sorting",Ie="list",ds="tile",hs=t=>{const{className:a,...s}=t,n=p(Le,b,a),[r,c]=Y(),o=r.get(fe)===Ie,l=i.useRef(null),{t:u}=ue(),{state:_,nextUrlValue:m,handleChange:h}=G({defaultState:Be,params:r,urlParamName:Pe,onChangeFn:We,convertToStateFn:Ke,convertToParamFn:ze}),{state:E,nextUrlValue:R,handleChange:g}=G({params:r,urlParamName:le,defaultState:Be,onChangeFn:We,convertToStateFn:Ke,convertToParamFn:ze});i.useEffect(()=>{var d;(d=l.current)==null||d.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},[E]);const f=i.useCallback(d=>{c(N=>(N.set(fe,d.currentTarget.value),N))},[c]),P=i.useCallback(d=>{d.preventDefault();const N=[[le,R],[Pe,m]];N.some(([C,I])=>I!==void 0)&&c(C=>(N.forEach(([I,j])=>{j?C.set(I,j):j===null&&C.delete(I)}),C))},[c,R,m]),v=i.useMemo(()=>Qt(u),[u]);return e.jsxs("header",{className:n,...s,children:[e.jsxs("form",{className:rs,onSubmit:P,ref:l,children:[e.jsxs("div",{className:us,children:[e.jsx(Te,{className:ms,view:"primary",theme:"primary",name:"searchText",type:"search",placeholder:u(A.SearchForProduct),value:_,onChange:h}),e.jsx(z,{type:"submit",el:"button",view:"primary",theme:"primary",size:"sm",className:_s,children:u(A.Search)})]}),e.jsxs("div",{className:os,children:[e.jsx("label",{className:is,htmlFor:"sorting",children:u(A.SortBy)}),e.jsx(gt,{className:ls,view:"primary",theme:"primary",id:"sorting",name:"sorting",options:v,value:E,onChange:g})]})]}),e.jsxs("div",{className:cs,children:[e.jsx(z,{selected:!o,view:"icon",theme:"primary",el:"button",value:ds,icon:e.jsx(vt,{}),onClick:f}),e.jsx(z,{selected:o,view:"icon",el:"button",value:Ie,theme:"primary",icon:e.jsx(Ot,{}),onClick:f})]})]})},Cs=i.memo(hs),je="product-list",Ns=`${je}_mode_list`,Es=`${je}__card`,gs=t=>{const{className:a,productProjections:s}=t,[n]=Y(),r=y(X),c=n.get(fe)===Ie,o=p(je,a,{[Ns]:c}),l=n.get(le),{categoryId:u}=ie(),_=y(Rt),m=i.useMemo(()=>{if(l){const[E,R]=l.split("_"),g=R;if(E==="price"&&(g===Ge.asc||g===Ge.desc))return g}},[l]),h=i.useMemo(()=>s==null?void 0:s.map(E=>e.jsx(jt,{className:Es,productProjection:E,isListMode:c,priceSorting:m,locale:r,categoryId:u,discounts:_},E.id)),[s,c,m,r,u,_]);return e.jsx("div",{className:o,children:h})},Rs=i.memo(gs),Fe="color-checkbox",xs=`${Fe}__box`,ps=`${Fe}__control`,Ts=t=>{const{className:a,controlProps:s,color:n,...r}=t,c=xt(Fe,a);return e.jsxs("label",{...r,className:c,"data-testid":"color-checkbox",children:[e.jsx("input",{...s,type:"checkbox",className:ps}),e.jsx("span",{className:xs,style:{backgroundColor:n}})]})},fs=i.memo(Ts),at="color-palette",Ps=`${at}__color`,Is=t=>{const{className:a,state:s,onStateChange:n,name:r}=t,c=p(at,a),o=i.useMemo(()=>Object.entries(s).map(([l,u])=>{const[_,m]=l.split(":#");return e.jsx(fs,{className:Ps,color:`#${m}`,title:_,controlProps:{name:r,value:l,checked:u,onChange:n}},l)}),[s,r,n]);return e.jsx("div",{className:c,children:o})},Ss=i.memo(Is),ct="checkbox-list",Ls=`${ct}__item`,As=t=>{const{className:a,state:s,onStateChange:n,name:r}=t,c=p(ct,a),o=i.useMemo(()=>Object.entries(s).map(([l,u])=>e.jsx(nt,{className:Ls,labelContent:l,checkboxProps:{theme:"primary",view:"primary",controlProps:{id:l,name:r,value:l,checked:u,onChange:n}}},l)),[s,n,r]);return e.jsx("div",{className:c,children:o})},vs=i.memo(As),me="interval-slider",Os=`${me}__slider`,js=`${me}__wrap`,Xe=`${me}__input`,Fs=t=>{const{state:a,minValueControlName:s,maxValueControlName:n,className:r,minValueInputName:c,maxValueInputName:o,onStateChange:l,...u}=t,{minValue:_,maxValue:m,values:h}=a,E=p(me,r),[R,g]=i.useState(h),f=i.useCallback(P=>{const{target:{name:v,value:d}}=P,N=Number(d);isFinite(N)&&g(C=>v.startsWith(Oe)?[N,C[1]]:[C[0],N])},[]);return i.useEffect(()=>{g(h)},[h,c,o]),e.jsxs("div",{...u,className:E,children:[e.jsx(ts,{state:a,onStateChange:l,minValueControlName:s,maxValueControlName:n,className:Os}),e.jsxs("div",{className:js,children:[e.jsx(Te,{name:c,className:Xe,value:R[0],type:"number",theme:"primary",view:"primary",onChange:f,onBlur:l,min:_,max:m}),e.jsx(Te,{name:o,className:Xe,value:R[1],type:"number",theme:"primary",view:"primary",min:_,max:m,onChange:f,onBlur:l}),e.jsx("input",{type:"submit",value:"",style:{display:"none"}})]})]})},Ms=i.memo(Fs),w="product-filter",ys=`${w}__wrap`,se=`${w}__block`,ne=`${w}__block-title`,$s=`${w}__buttons`,Ye=`${w}__button`,U="stock",Se="true",k="color",B="size",oe="price",Qe="min-price",qe="max-price",bs={[Se]:!1},Ds=0,Vs=1e8,Us=t=>{const{className:a,...s}=t,n=p(Le,w,a),r=y(X),[c,o]=Y(),{categoryId:l}=ie(),u=y(et),{t:_}=ue(),m=i.useMemo(()=>({"filter.query":[`categories.id:"${l}"`],markMatchingVariants:!0,priceCurrency:tt[u],priceCountry:u,limit:500}),[l,u]),{data:h,isFetching:E,isError:R}=st(m),g=i.useMemo(()=>{const S=new Set,L=new Set,x=[];let M=0;h==null||h.results.forEach(({masterVariant:_e,variants:de})=>{[_e,...de].forEach(Ve=>{const{priceData:Ue,attributes:he}=Ve;Ue&&(x.push(Ue.currentPrice),M||(M=Ve.scopedPrice.currentValue.fractionDigits)),he==null||he.forEach(({name:ke,value:Ct})=>{const Z=Ct[r];ke===k&&Z?S.add(Z):ke===B&&Z&&L.add(Z)})})}),x.sort((_e,de)=>_e-de);const dt=x.length?Math.floor(x[0]):Ds,ht=x.length?Math.ceil(x[x.length-1]):Vs;return{colorsData:S,sizesData:L,minPrice:dt,maxPrice:ht,priceFrDigits:M}},[r,h]),{colorsData:f,sizesData:P,minPrice:v,maxPrice:d,priceFrDigits:N}=g,C=i.useMemo(()=>({minValue:v,maxValue:d,values:[v,d]}),[v,d]),I=i.useMemo(()=>ns(S=>S.split(";").map(L=>L.slice(0,-N))),[N]),j=i.useMemo(()=>as(S=>S.values.map(L=>L!==0?L+"0".repeat(N):L).join(";")),[N]),{state:O,nextUrlValue:T,handleChange:F}=G({params:c,defaultState:C,urlParamName:oe,onChangeFn:ss,convertToStateFn:I,convertToParamFn:j}),$=i.useMemo(()=>{const S=L=>[...L].reduce((x,M)=>(x[M]=!1,x),{});return{defaultColorFilterState:S(f),defaultSizeFilterState:S(P)}},[f,P]),{state:V,nextUrlValue:$e,handleChange:rt}=G({params:c,defaultState:bs,urlParamName:U,onChangeFn:Ce,convertToStateFn:Ne,convertToParamFn:Ee}),{state:ot,nextUrlValue:be,handleChange:lt}=G({params:c,defaultState:$.defaultColorFilterState,urlParamName:k,onChangeFn:Ce,convertToStateFn:Ne,convertToParamFn:Ee}),{state:it,nextUrlValue:De,handleChange:ut}=G({params:c,defaultState:$.defaultSizeFilterState,urlParamName:B,onChangeFn:Ce,convertToStateFn:Ne,convertToParamFn:Ee}),mt=i.useCallback(()=>{const S=[[U,$e],[k,be],[B,De],[oe,T]];S.some(([L,x])=>x!==void 0)&&o(L=>(S.forEach(([x,M])=>{M?L.set(x,M):M===null&&L.delete(x)}),L))},[o,$e,be,De,T]);let J;E?J=e.jsx(Ae,{}):R?J=e.jsx(ve,{}):J=e.jsxs(e.Fragment,{children:[!!Object.keys($.defaultColorFilterState).length&&e.jsxs("div",{className:se,children:[e.jsx("h4",{className:p(ee,ne),children:_(A.Colors)}),e.jsx(Ss,{state:ot,name:k,onStateChange:lt})]}),!!Object.keys($.defaultSizeFilterState).length&&e.jsxs("div",{className:se,children:[e.jsx("h4",{className:p(ee,ne),children:"Sizes"}),e.jsx(vs,{name:B,state:it,onStateChange:ut})]})]});const _t=i.useCallback(()=>{const S=[U,k,B,oe];S.some(x=>c.get(x))&&o(x=>(S.forEach(M=>x.delete(M)),x))},[o,c]);return e.jsx("div",{className:n,...s,children:e.jsxs("div",{className:ys,children:[e.jsxs("div",{className:se,children:[e.jsx("h4",{className:p(ee,ne),children:_(A.Availability)}),e.jsx(nt,{labelContent:_(A.OnlyProductsThatAreInStock),checkboxProps:{theme:"primary",view:"primary",controlProps:{name:U,id:U,value:Se,checked:V[Se],onChange:rt}}})]}),e.jsxs("div",{className:se,children:[e.jsx("h4",{className:p(ee,ne),children:_(A.Price)}),e.jsx("div",{children:e.jsx(Ms,{minValueInputName:Qe,maxValueInputName:qe,minValueControlName:Qe,maxValueControlName:qe,state:O,onStateChange:F})})]}),J,e.jsxs("div",{className:$s,children:[e.jsx(z,{type:"button",el:"button",theme:"primary",view:"primary",size:"sm",onClick:_t,className:Ye,children:_(A.Reset)}),e.jsx(z,{type:"button",el:"button",theme:"primary",view:"primary",size:"sm",onClick:mt,className:Ye,children:_(A.Apply)})]})]})})},ks=i.memo(Us),ae=(t,a)=>{const s=a-t+1;return Array.from({length:s},(n,r)=>r+t)},W="...",Bs=({numberOfPages:t,numOfVisibleButtons:a,currentPage:s})=>{if(t<=a)return ae(1,t);const n=1,r=t,c=a-4,o=a-3,l=s<=n+2,u=s>=r-2,_=!l&&!u;if(l)return[...ae(n,n+o),W,r];if(u){const m=ae(r-o,r);return[n,W,...m]}if(_){const m=Math.floor((c-1)/2),h=c-1-m,E=ae(s-m,s+h);return[n,W,...E,W,r]}return[]},H="pagination",ge=`${H}__item`,K=`${H}__btn`,Gs=`${H}__placeholder`,ws=`${K}_selected`,Je=`${K}_disabled`,Hs=`${H}__btn-next`,Ws=`${H}__btn-prev`,zs="Number of visible pages should be at least 7",Me="page",Re=(t,a)=>{const{pathname:s,search:n}=t,r=new URLSearchParams(n);return r.set(Me,`${a}`),`${s}?${r.toString()}`},Ks=({perPageCount:t,className:a,totalCount:s=0,maxNumOfVisiblePages:n=7,prevBtnLabel:r="«",nextBtnLabel:c="»"})=>{if(n<7)throw new Error(zs);const o=Math.ceil(s/t),[l]=Y(),u=pt(),_=l.get(Me),m=i.useMemo(()=>{const C=parseInt(_||"");return isNaN(C)||C<=0?1:C>o?o:C},[_,o]),h=i.useMemo(()=>Bs({numberOfPages:o,numOfVisibleButtons:n,currentPage:m}),[o,n,m]),E=m===o,R=m===1,g=p(K,Ws,{[Je]:R}),f=i.useMemo(()=>{const C=Re(u,m-1);return e.jsx("li",{className:ge,children:R?e.jsx("span",{className:g,children:r}):e.jsx(re,{className:g,to:C,relative:"path",children:r})})},[m,R,g,r,u]),P=p(K,Hs,{[Je]:E}),v=i.useMemo(()=>{const C=Re(u,m+1);return e.jsx("li",{className:ge,children:E?e.jsx("span",{className:P,children:c}):e.jsx(re,{className:P,to:C,relative:"path",children:c})})},[m,E,P,c,u]),d=i.useMemo(()=>h==null?void 0:h.map((C,I)=>{const j=p(K,{[ws]:m===C}),O=Re(u,C);return e.jsx("li",{className:ge,children:C===W?e.jsx("span",{className:Gs,children:C}):e.jsx(re,{className:j,to:O,relative:"path",children:C})},`${I}_${C}`)}),[m,h,u]),N=p(H,a);return e.jsxs("ul",{className:N,children:[f,d,v]})},Xs=i.memo(Ks),q="products",ce=`${q}__list`,Ys=`${q}__header`,Qs=`${q}__filter-wrap`,qs=`${q}__filter`,xe=10,Js=t=>{const{className:a,...s}=t,n=p(q,a),{categoryId:r}=ie(),[c]=Y(),o=y(X),l=c.get(Pe),u=c.get(le),_=c.get(U),m=c.get(k),h=c.get(B),E=c.get(oe),R=y(et),g=c.get(Me),{t:f}=ue(),P=i.useMemo(()=>{const T=parseInt(g||"",10);return isNaN(T)||T<=0?1:T},[g]),v=i.useMemo(()=>{const T=[`categories.id:"${r}"`];if(_&&T.push("variants.availability.isOnStock:true"),m&&T.push(`variants.attributes.color.${o}:${m}`),h&&T.push(`variants.attributes.size.${o}:${h}`),E){const[$,V]=E.split(";");T.push(`variants.scopedPrice.currentValue.centAmount:range (${$} to ${V})`)}const F={"filter.query":T,markMatchingVariants:!0,priceCurrency:tt[R],priceCountry:R,limit:xe,offset:(P-1)*xe};if(l&&(F[`text.${o}`]=l,F.fuzzy=!0),u){const[$,V]=u.split("_");$==="name"?F.sort=`${$}.${o} ${V}`:$==="price"&&(F.sort=`variants.scopedPrice.currentValue.centAmount ${V}`)}return F},[r,R,P,l,u,_,m,h,E,o]),{data:d,isFetching:N,isError:C}=st(v),I=i.useMemo(()=>C||!(d!=null&&d.total)?0:d.total,[C,d]),{isFetching:j}=Tt();let O;return N||j?O=e.jsx(Ae,{className:ce,isBlock:!0}):C?O=e.jsx(ve,{className:ce,isBlock:!0}):d!=null&&d.results.length?O=e.jsx(e.Fragment,{children:e.jsx(Rs,{className:ce,productProjections:d==null?void 0:d.results},JSON.stringify(v))}):O=e.jsxs("div",{className:p(Le,ce),children:[f(A.NothingWasFound)," :("]}),e.jsxs("section",{className:n,...s,children:[e.jsx(Cs,{className:Ys}),e.jsx("div",{className:Qs,children:e.jsx(ks,{className:qs})}),O,!!I&&e.jsx(Xs,{perPageCount:xe,totalCount:I})]})},Zs=i.memo(Js),ye="view-catalog",en=`${ye}__title`,tn=`${ye}__breadcrumbs`,sn=()=>{const t=y(X),{isFetching:a,isError:s}=ft(),{currentCategory:n,categoryId:r}=Ht(),c=Ft(),o=y(Pt),{t:l}=ue(),u=i.useMemo(()=>o.filter(h=>{var E;return((E=h.parent)==null?void 0:E.id)===(n==null?void 0:n.id)}).map(h=>h.id),[o,n]);let _;a?_=e.jsx(Ae,{}):s?_=e.jsx(ve,{isBlock:!0}):n||r===void 0?u.length?_=e.jsx(wt,{ids:u}):_=e.jsx(Zs,{}):_=e.jsx(It,{to:pe(St),relative:"path",replace:!0});const m=n?n.name[t]:l(A.Catalog);return e.jsx("main",{className:ye,children:e.jsxs("div",{className:Lt,children:[e.jsx("h1",{className:p(At,en),children:m}),e.jsx(Mt,{crumbs:c,className:tn}),_]})})},un=i.memo(sn);export{ye as VIEW_CATALOG,tn as VIEW_CATALOG_BREADCRUMBS,en as VIEW_CATALOG_TITLE,un as default};
